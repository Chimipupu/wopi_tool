<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ä¸–ç•Œæ™‚è¨ˆ</title>
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-color: #f0f8ff;
            color: #333;
        }
        h1 {
            color: #4a90e2;
            margin-bottom: 20px;
        }
        .clock {
            display: inline-block;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
            margin: 10px;
            width: 250px;
            font-size: 20px;
            color: #4a4a4a;
            border: 2px solid #4a90e2;
            text-align: center;
        }
        .clock .country {
            font-size: 24px;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .clock .time {
            font-weight: bold;
            font-size: 24px;
            border: 2px solid #4a90e2;
            padding: 10px;
            border-radius: 10px;
            display: inline-block;
            margin-top: 10px;
        }
        .countdown {
            margin-top: 20px;
            font-size: 18px;
            color: #e94e77;
            border: 2px solid #4a90e2;
            padding: 20px;
            border-radius: 15px;
            display: inline-block;
            width: 350px;
            text-align: center;
            background-color: #fff5f5;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .countdown .title {
            font-size: 22px;
            color: #e94e77;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .countdown .date {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .countdown .remaining {
            font-size: 20px;
            color: #e94e77;
        }
        .countdown .icon {
            font-size: 30px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>ã‚’ã´ã®é‡Œâ™¨ãƒ›ãƒ¯ã‚¤ãƒˆä¼æ¥­</h1>
    <div id="japan-clock" class="clock"></div>
    <div id="washington-clock" class="clock"></div>
    <div id="london-clock" class="clock"></div>
    <div id="beijing-clock" class="clock"></div>
    <div id="seoul-clock" class="clock"></div>
    <div id="india-clock" class="clock"></div>
    <div id="sydney-clock" class="clock"></div>
    <div id="moscow-clock" class="clock"></div>

    <div class="countdown" id="countdown">
        <div class="icon">â™¨ï¸</div>
        <div id="countdown-content"></div>
    </div>

    <py-script>
        import asyncio
        import js
        from datetime import datetime, timedelta, timezone

        def format_time(time):
            return time.strftime("%Y-%m-%d %H:%M:%S")

        def update_clocks():
            now_utc = datetime.utcnow()

            # å„ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
            offsets = {
                'japan': 9,
                'washington': -4,
                'london': 1,
                'beijing': 8,
                'seoul': 9,
                'india': 5.5,
                'sydney': 11,
                'moscow': 3
            }

            tz_info = {
                'japan': ('ğŸ‡¯ğŸ‡µ', 'æ±äº¬'),
                'washington': ('ğŸ‡ºğŸ‡¸', 'ãƒ¯ã‚·ãƒ³ãƒˆãƒ³'),
                'london': ('ğŸ‡¬ğŸ‡§', 'ãƒ­ãƒ³ãƒ‰ãƒ³'),
                'beijing': ('ğŸ‡¨ğŸ‡³', 'åŒ—äº¬'),
                'seoul': ('ğŸ‡°ğŸ‡·', 'ã‚½ã‚¦ãƒ«'),
                'india': ('ğŸ‡®ğŸ‡³', 'ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒªãƒ¼'),
                'sydney': ('ğŸ‡¦ğŸ‡º', 'ã‚·ãƒ‰ãƒ‹ãƒ¼'),
                'moscow': ('ğŸ‡·ğŸ‡º', 'ãƒ¢ã‚¹ã‚¯ãƒ¯')
            }

            for key, (flag, capital) in tz_info.items():
                offset_hours = offsets[key]
                if offset_hours % 1 == 0:
                    offset = timezone(timedelta(hours=int(offset_hours)))
                else:
                    offset = timezone(timedelta(hours=int(offset_hours), minutes=int((offset_hours % 1) * 60)))

                local_time = now_utc.replace(tzinfo=timezone.utc).astimezone(offset)
                js.document.getElementById(f'{key}-clock').innerHTML = \
                    f'<div class="country">{capital} {flag}</div>' \
                    f'<div class="time">{format_time(local_time)}</div>'

            # ãƒ ãƒ•ã‚§ãƒˆã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
            japan_offset = timezone(timedelta(hours=9))
            now_japan = now_utc.replace(tzinfo=timezone.utc).astimezone(japan_offset)

            # åŸºæº–æ—¥ã¨å‘¨æœŸã®è¨­å®š
            base_start_time = datetime(2024, 5, 3, 9, 0, 0, tzinfo=japan_offset)
            period_length = timedelta(weeks=2)  # 2é€±é–“ã”ã¨ã®å‘¨æœŸ

            # ç¾åœ¨ãŒãƒ ãƒ•ã‚§ãƒˆæœŸé–“ã‹ãƒãƒ æœŸé–“ã‹ã‚’åˆ¤æ–­
            def get_current_period(start_time, now_time, period_length):
                elapsed_time = now_time - start_time
                periods_elapsed = elapsed_time // period_length
                current_period_start = start_time + periods_elapsed * period_length
                current_period_end = current_period_start + period_length

                # å¶æ•°æœŸé–“ãŒãƒ ãƒ•ã‚§ãƒˆã€å¥‡æ•°æœŸé–“ãŒãƒãƒ ã¨ä»®å®š
                if periods_elapsed % 2 == 0:
                    return "ãƒ ãƒ•ã‚§ãƒˆ", current_period_start, current_period_end
                else:
                    return "ãƒãƒ ", current_period_start, current_period_end

            # ç¾åœ¨ã®æœŸé–“ã‚’å–å¾—
            current_period, period_start_time, period_end_time = get_current_period(base_start_time, now_japan, period_length)

            if current_period == "ãƒ ãƒ•ã‚§ãƒˆ":
                # æ®‹ã‚Šã®ãƒ ãƒ•ã‚§ãƒˆæœŸé–“ã‚’è¨ˆç®—
                remaining_time = period_end_time - now_japan
                countdown_text = (
                    '<div class="title">ãƒ ãƒ•ã‚§ãƒˆæœŸé–“ï¼ˆã‚’ã´ã®é‡Œ ç¹å¿™æœŸï¼‰</div>' +
                    f'<div class="date">ãƒ ãƒ•ã‚§ãƒˆé–‹å§‹æ—¥: {period_start_time.strftime("%Y-%m-%d %H:%M:%S")}</div>' +
                    f'<div class="date">ãƒ ãƒ•ã‚§ãƒˆçµ‚äº†æ—¥: {period_end_time.strftime("%Y-%m-%d %H:%M:%S")}</div>' +
                    f'<div class="remaining">æ®‹ã‚Šæ—¥æ•°: {remaining_time.days}æ—¥ {remaining_time.seconds // 3600}æ™‚é–“ {remaining_time.seconds % 3600 // 60}åˆ†</div>'
                )
            else:
                # æ¬¡ã®ãƒ ãƒ•ã‚§ãƒˆæœŸé–“ã®é–‹å§‹æ™‚é–“ã‚’è¨ˆç®—
                next_mhf_start_time = period_end_time  # æ¬¡ã®ãƒ ãƒ•ã‚§ãƒˆé–‹å§‹ã¯ç¾åœ¨ã®ãƒãƒ æœŸé–“ãŒçµ‚ã‚ã£ãŸå¾Œ
                countdown_text = (
                    '<div class="title">ãƒãƒ æœŸé–“</div>' +
                    f'<div class="remaining">æ¥æœŸãƒ ãƒ•ã‚§ãƒˆ: {next_mhf_start_time.strftime("%Y-%m-%d %H:%M:%S")}</div>'
                )

            js.document.getElementById('countdown-content').innerHTML = countdown_text

        # åˆæœŸè¡¨ç¤º
        update_clocks()

        # 1ç§’ã”ã¨ã«æ›´æ–°
        async def periodic_update():
            while True:
                update_clocks()
                await asyncio.sleep(1)

        # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã™ã‚‹
        asyncio.ensure_future(periodic_update())
    </py-script>
</body>
</html>
