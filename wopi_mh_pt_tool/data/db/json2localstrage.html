<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚’ã´ã®é‡Œâ™¨ DBãŠå¼•è¶Šã—ãƒ„ãƒ¼ãƒ«ğŸšš Ver0.1.0</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffeef8;
            color: #333;
            text-align: center;
            padding: 20px;
        }

        h1 {
            color: #ff69b4;
        }

        h2 {
            color: #ff69b4;
            font-size: 24px;
        }

        button {
            background-color: #ff1493;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #ff69b4;
        }

        .file-input-container {
            display: inline-block;
            /* block ã‹ã‚‰ inline-block ã«å¤‰æ›´ */
            position: relative;
            margin: 20px;
        }

        .file-input-button {
            font-size: 16px;
            padding: 10px 20px;
            background-color: #ff69b4;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            outline: none;
            position: relative;
            z-index: 1;
            /* ãƒœã‚¿ãƒ³ã‚’å‰é¢ã«é…ç½® */
        }

        .file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 2;
            /* inputã‚’ãƒœã‚¿ãƒ³ã«å¯¾å¿œã™ã‚‹ç¯„å›²ã®ã¿ã«åˆ¶é™ */
        }


        /* å›ºå®šå¹…ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­å®š */
        td.fixed-width {
            width: 200px;
            /* å›ºå®šã—ãŸã„å¹…ã‚’è¨­å®š */
            word-wrap: break-word;
            /* é•·ã„ãƒ†ã‚­ã‚¹ãƒˆãŒã‚»ãƒ«ã®å¹…ã‚’è¶…ãˆã‚‹å ´åˆã«æŠ˜ã‚Šè¿”ã™ */
            overflow: hidden;
            /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚»ãƒ«ã‚’è¶…ãˆã‚‹å ´åˆã«éš ã™ */
            white-space: nowrap;
            /* ãƒ†ã‚­ã‚¹ãƒˆãŒæŠ˜ã‚Šè¿”ã•ã‚Œãšã«ä¸€è¡Œã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆå¿…è¦ã«å¿œã˜ã¦å¤‰æ›´ï¼‰ */
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
            display: none;
            /* Initially hide the table */
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚»ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        th {
            background-color: #ff69b4;
            color: white;
        }

        /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚»ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        td {
            border: 1px solid #ff1493;
            padding: 10px;
            text-align: left;
            background-color: #fff;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«é©ç”¨ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ« */
        table.show {
            display: table;
            /* ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«é©ç”¨ */
        }

        #console {
            margin-top: 20px;
            font-size: 14px;
            color: #ff1493;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <h1>ã‚’ã´ã®é‡Œâ™¨ DBãŠå¼•è¶Šã—ãƒ„ãƒ¼ãƒ«ğŸšš Ver0.1.0</h1>
    <div id="console"></div>
    <div class="file-input-container">
        <button class="file-input-button" id="fileLoadButton">DBé¸æŠ</button>
        <input type="file" id="fileInput" class="file-input" accept=".json" onchange="handleFileSelect(event)">
    </div>
    <button id="localStorageDLBTN" type="button" onclick="localStorageDowonLoad()">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
    <button id="localStorageRestoreBTN" type="button" onclick="JSON2LcalStorage()">ãƒªã‚¹ãƒˆã‚¢</button>
    <table id="dataTable">
        <thead>
            <tr>
                <th class="fixed-width">Key</th>
                <th class="fixed-width">Value</th>
            </tr>
        </thead>
        <tbody id="dataTableBody">
            <!-- Data rows will be inserted here -->
        </tbody>
    </table>

<script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ã¿å…ƒ
        window.onload = function () {
            document.getElementById('console').innerText += "ã€ä½¿ã„æ–¹ã€‘\n";
            document.getElementById('console').innerText += "ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€...DBã‚’Download\n";
            document.getElementById('console').innerText += "ã€ãƒªã‚¹ãƒˆã‚¢ã€...DBã‚’ãƒªã‚¹ãƒˆã‚¢ï¼ˆå¾©å…ƒï¼‰\n";
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type === 'application/json') {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const fileData = JSON.parse(event.target.result);
                    console.log("File data read:", fileData);
                    // document.getElementById('console').innerText = "File data read:\n" + JSON.stringify(fileData, null, 2);
                    // ã“ã“ã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†
                };
                reader.readAsText(file);
            } else {
                console.error("Invalid file format. Please select a JSON file.");
                // document.getElementById('console').innerText = "Invalid file format. Please select a JSON file.";
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ã§HTMLè¡¨ç¤º
        function showData(footBathMembers, members, quests) {
            const data = [
                { key: 'members', value: members },
                { key: 'footBathMembers', value: footBathMembers },
                { key: 'quests', value: quests }
            ];

            const table = document.getElementById('dataTable');
            const tableBody = document.getElementById('dataTableBody');
            tableBody.innerHTML = ''; // Clear any existing rows

            data.forEach(item => {
                const row = document.createElement('tr');

                // Key Cell
                const keyCell = document.createElement('td');
                keyCell.textContent = item.key;
                keyCell.style.fontWeight = 'bold';
                row.appendChild(keyCell);

                // Value Cell
                const valueCell = document.createElement('td');
                if (Array.isArray(item.value)) {
                    // Convert each sub-array into a string and add <br> after each
                    const formattedValue = item.value.map(subItem => JSON.stringify(subItem)).join('<br>');
                    valueCell.innerHTML = `<pre>${formattedValue}</pre>`;
                } else {
                    valueCell.textContent = item.value;
                }

                row.appendChild(valueCell);
                tableBody.appendChild(row);
            });

            // Display the table after data is shown
            table.style.display = 'table';

            console.log("LocalStorage Data displayed in table.");
            // document.getElementById('console').innerText = "LocalStorage Data displayed in table.";
        }

        // JSON to localStorage Save
        function JSON2LcalStorage() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (file && file.type === 'application/json') {
                const reader = new FileReader();

                reader.onload = function (event) {
                    try {
                        // JSONãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å‡ºã—
                        const fileData = JSON.parse(event.target.result);
                        console.log("JSON Read Data:", fileData);
                        // document.getElementById('console').innerText = "JSON Read Data:\n" + JSON.stringify(fileData, null, 2);

                        // ã“ã“ã§ç”»é¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºã—ã¨ã
                        footBathMembers = JSON.stringify(fileData.footBathMembers);
                        members = JSON.stringify(fileData.members);
                        quests = JSON.stringify(fileData.quests);
                        showData(footBathMembers, members, quests);

                        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                        localStorage.setItem('members', JSON.stringify(fileData.members || {}));
                        localStorage.setItem('footBathMembers', JSON.stringify(fileData.footBathMembers || {}));
                        localStorage.setItem('quests', JSON.stringify(fileData.quests || {}));

                        console.log("JSON to localStorage Data Save OK!!!");
                        // document.getElementById('console').innerText += "\n\nJSON to localStorage Data Save OK!!!";
                    } catch (error) {
                        console.error("[ERR]: JSON read Data fail!:", error);
                        // document.getElementById('console').innerText = "[ERR]: JSON read Data fail!: " + error.message;
                    }
                };

                reader.readAsText(file);
            } else {
                console.error("ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ã€‚JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
                // document.getElementById('console').innerText = "ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ã€‚JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚";
            }
        }

        // localStorage to JSON(savedata-YYYYMMDD.json) Download
        function localStorageDowonLoad() {
            const footBathMembers = localStorage.getItem('footBathMembers');
            const members = localStorage.getItem('members');
            const quests = localStorage.getItem('quests');

            if (footBathMembers || members || quests) {
                const date = new Date();
                const formattedDate = date.toISOString().slice(0, 10).replace(/-/g, '');
                const filename = `wopi_db_${formattedDate}.json`;

                const data = {
                    footBathMembers: footBathMembers ? JSON.parse(footBathMembers) : {},
                    members: members ? JSON.parse(members) : {},
                    quests: quests ? JSON.parse(quests) : {}
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);

                console.log("LocalStorage Download (JSON :", filename);
                // document.getElementById('console').innerText = "LocalStorage BackUped";
            } else {
                console.error("[ERR]: LocalStorage No Data");
                // document.getElementById('console').innerText = "[ERR]: LocalStorage No Data";
            }
        }
    </script>
</body>

</html>